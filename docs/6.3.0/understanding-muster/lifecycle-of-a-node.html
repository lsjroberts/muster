<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Lifecycle of a Node · Muster</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;One thing we haven&#x27;t touched on before is a lifecycle of a node. When you create a graph Muster doesn&#x27;t resolve any node until you subscribe to them in one way or another. The subscription can be created in two ways:&lt;/p&gt;
"/><meta name="docsearch:version" content="6.3.0"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Lifecycle of a Node · Muster"/><meta property="og:type" content="website"/><meta property="og:url" content="https://dwstech.github.io/muster/index.html"/><meta property="og:description" content="&lt;p&gt;One thing we haven&#x27;t touched on before is a lifecycle of a node. When you create a graph Muster doesn&#x27;t resolve any node until you subscribe to them in one way or another. The subscription can be created in two ways:&lt;/p&gt;
"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/muster/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/vs2015.min.css"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-129699840-1"></script><script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments); }
              gtag('js', new Date());
              gtag('config', 'UA-129699840-1');
            </script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab"/><link rel="stylesheet" href="https://unpkg.com/tippy.js@3/dist/themes/light.css"/><script type="text/javascript" src="https://cdn.polyfill.io/v2/polyfill.min.js"></script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js" async=""></script><script type="text/javascript" src="https://unpkg.com/tippy.js@3/dist/tippy.all.min.js" async=""></script><script type="text/javascript" src="/muster/js/code-blocks-buttons.js" async=""></script><script type="text/javascript" src="/muster/js/glossary.min.js" async=""></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><link rel="stylesheet" href="/muster/css/main.css"/></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/muster/"><h2 class="headerTitle">Muster</h2></a><a href="/muster/versions"><h3>6.3.0</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/muster/docs/6.3.0/overview" target="_self">Docs</a></li><li class=""><a href="/muster/api/" target="_self">API reference</a></li><li class=""><a href="/muster/playground/" target="_self">Playground</a></li><li class="siteNavGroupActive"><a href="/muster/docs/6.3.0/resources/faq" target="_self">FAQ</a></li><li class=""><a href="/muster/help" target="_self">Help</a></li><li class=""><a href="https://github.com/dwstech/muster" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Understanding Muster</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Overview</h3><ul><li class="navListItem"><a class="navItem" href="/muster/docs/6.3.0/overview">Muster Overview</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Learn</h3><ul><li class="navListItem"><a class="navItem" href="/muster/docs/6.3.0/learn/introduction">Introduction</a></li><li class="navListItem"><a class="navItem" href="/muster/docs/6.3.0/learn/graph-structure">Graph Data Structure</a></li><li class="navListItem"><a class="navItem" href="/muster/docs/6.3.0/learn/nodes">Nodes</a></li><li class="navListItem"><a class="navItem" href="/muster/docs/6.3.0/learn/variables">Variables</a></li><li class="navListItem"><a class="navItem" href="/muster/docs/6.3.0/learn/async-data">Asynchronous Data</a></li><li class="navListItem"><a class="navItem" href="/muster/docs/6.3.0/learn/functions">Functions</a></li><li class="navListItem"><a class="navItem" href="/muster/docs/6.3.0/learn/collections">Collections</a></li><li class="navListItem"><a class="navItem" href="/muster/docs/6.3.0/learn/control-flow">Control Flow</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Understanding Muster</h3><ul><li class="navListItem"><a class="navItem" href="/muster/docs/6.3.0/understanding-muster/data-store">How Muster Stores Data</a></li><li class="navListItem"><a class="navItem" href="/muster/docs/6.3.0/understanding-muster/resolution-chains">Resolution Chains</a></li><li class="navListItem"><a class="navItem" href="/muster/docs/6.3.0/understanding-muster/explicit-definition">Explicit Definitions</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/muster/docs/6.3.0/understanding-muster/lifecycle-of-a-node">Lifecycle of a Node</a></li><li class="navListItem"><a class="navItem" href="/muster/docs/6.3.0/understanding-muster/scope">Scope</a></li><li class="navListItem"><a class="navItem" href="/muster/docs/6.3.0/understanding-muster/crafting-muster-nodes">Crafting Muster Nodes</a></li><li class="navListItem"><a class="navItem" href="/muster/docs/6.3.0/understanding-muster/optimisation">Optimisation*</a></li><li class="navListItem"><a class="navItem" href="/muster/docs/6.3.0/understanding-muster/security">Security*</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Tutorials</h3><ul><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Muster</h4><ul><li class="navListItem"><a class="navItem" href="/muster/docs/6.3.0/tutorials/muster-server">Muster on the Server</a></li><li class="navListItem"><a class="navItem" href="/muster/docs/6.3.0/tutorials/muster-worker">Running Muster in a Worker</a></li><li class="navListItem"><a class="navItem" href="/muster/docs/6.3.0/tutorials/muster-cookbook">Muster Cookbook</a></li><li class="navListItem"><a class="navItem" href="/muster/docs/6.3.0/tutorials/muster-testing">Muster Unit Testing</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Muster React</h4><ul><li class="navListItem"><a class="navItem" href="/muster/docs/6.3.0/tutorials/muster-react-tutorial">Muster React Tutorial</a></li><li class="navListItem"><a class="navItem" href="/muster/docs/6.3.0/tutorials/muster-react-cookbook">Muster React Cookbook</a></li><li class="navListItem"><a class="navItem" href="/muster/docs/6.3.0/tutorials/muster-react-testing">Muster React Unit Testing</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Resources</h3><ul><li class="navListItem"><a class="navItem" href="/muster/docs/6.3.0/resources/setup">Setup</a></li><li class="navListItem"><a class="navItem" href="/muster/docs/6.3.0/resources/faq">Frequently Asked Questions (FAQ)</a></li><li class="navListItem"><a class="navItem" href="/muster/docs/6.3.0/resources/essential-nodes">Essential Nodes</a></li><li class="navListItem"><a class="navItem" href="/muster/docs/6.3.0/resources/common-muster-errors">Common Muster Errors</a></li><li class="navListItem"><a class="navItem" href="/muster/docs/6.3.0/resources/thinking-in-muster">Thinking in Muster*</a></li><li class="navListItem"><a class="navItem" href="/muster/docs/6.3.0/glossary">Glossary</a></li><li class="navListItem"><a class="navItem" href="/muster/docs/6.3.0/changelog">Latest Changes</a></li></ul></div></div></section></div><script>
            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/dwstech/muster/edit/master/packages/website/docs/04-lifecycle.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 class="postHeaderTitle">Lifecycle of a Node</h1></header><article><div><span><p>One thing we haven't touched on before is a lifecycle of a node. When you create a graph Muster doesn't resolve any node until you subscribe to them in one way or another. The subscription can be created in two ways:</p>
<ul>
<li>Direct subscription, by doing <code>app.resolve(&lt;&lt;my node&gt;&gt;)</code>. This makes a subscription to a <code>&lt;&lt;my node&gt;&gt;</code> node.</li>
<li>Indirect subscription, by subscribing to a node that depends on a non-static node, or resolves to a non-static node.</li>
</ul>
 <!-- Is there a way to make this less contrived? -->
<p>Example of indirect subscription through a dependency:</p>
<pre><code class="hljs css language-javascript"><span class="hljs-keyword">import</span> muster, { computed, ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'@dws/muster'</span>;

<span class="hljs-keyword">const</span> app = muster({
  <span class="hljs-attr">firstName</span>: <span class="hljs-string">'Bob'</span>,
  <span class="hljs-attr">lastName</span>: <span class="hljs-string">'Smith'</span>,
  <span class="hljs-attr">fullName</span>: computed(
    [ref(<span class="hljs-string">'firstName'</span>), ref(<span class="hljs-string">'lastName'</span>)]
    (firstName, lastName) =&gt; {
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Subscribed to `fullName`'</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${firstName}</span> <span class="hljs-subst">${lastName}</span>`</span>;
    },
  ),
});

<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Subscribing to a computed that produces greeting...'</span>);
<span class="hljs-keyword">let</span> result = <span class="hljs-keyword">await</span> app.resolve(
  computed(
    [ref(<span class="hljs-string">'fullName'</span>)],
    (fullName) =&gt; {
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Subscribed to `greeting`'</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-string">`Hello, <span class="hljs-subst">${fullName}</span>!`</span>
    },
  ),
);
<span class="hljs-built_in">console</span>.log(result);

<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Subscribing to `ref("fullName")`'</span>);
result = <span class="hljs-keyword">await</span> app.resolve(ref(<span class="hljs-string">'fullName'</span>));
<span class="hljs-built_in">console</span>.log(result);

<span class="hljs-comment">// Console output:</span>
<span class="hljs-comment">// Subscribing to a computed node that produces greeting...</span>
<span class="hljs-comment">// Subscribed to `fullName`</span>
<span class="hljs-comment">// Subscribed to `greeting`</span>
<span class="hljs-comment">// Hello, Bob Smith!</span>
<span class="hljs-comment">// Subscribing to `ref("fullName")`</span>
<span class="hljs-comment">// Subscribed to `fullName`</span>
<span class="hljs-comment">// Bob Smith</span>
</code></pre>
<p>This example shows that the nodes are evaluated only when a subscription is made to them, and in which order such subscription is created. The <code>await</code> keyword next to the <code>app.resolve()</code> makes a quick subscription to the stream returned from <code>app.resolve()</code>, and unsubscribes once the first non-pending result is returned. Note that the second time we did <code>app.resolve(ref('fullName'))</code> produced a console log output <code>Subscribed to 'fullName'</code>.</p>
<p>Let's try changing the first use of <code>await</code> to a normal subscription, and see what happens then:</p>
<pre><code class="hljs css language-javascript"><span class="hljs-keyword">import</span> muster, { computed, ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'@dws/muster'</span>;

<span class="hljs-keyword">const</span> app = muster({
  <span class="hljs-attr">firstName</span>: <span class="hljs-string">'Bob'</span>,
  <span class="hljs-attr">lastName</span>: <span class="hljs-string">'Smith'</span>,
  <span class="hljs-attr">fullName</span>: computed(
    [ref(<span class="hljs-string">'firstName'</span>), ref(<span class="hljs-string">'lastName'</span>)]
    (firstName, lastName) =&gt; {
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Subscribed to `fullName`'</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${firstName}</span> <span class="hljs-subst">${lastName}</span>`</span>;
    },
  ),
});

<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Subscribing to a computed node that produces greeting...'</span>);
<span class="hljs-keyword">const</span> subscription = app.resolve(
  computed(
    [ref(<span class="hljs-string">'fullName'</span>)],
    (fullName) =&gt; {
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Subscribed to `greeting`'</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-string">`Hello, <span class="hljs-subst">${fullName}</span>!`</span>
    },
  ),
).subscribe(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
  <span class="hljs-built_in">console</span>.log(result);
});

<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'-----------'</span>);
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Subscribing to `ref("fullName")`'</span>);
<span class="hljs-keyword">const</span> result1 = <span class="hljs-keyword">await</span> app.resolve(ref(<span class="hljs-string">'fullName'</span>));
<span class="hljs-built_in">console</span>.log(result);
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'-----------'</span>);

<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Unsubscribing from `computed([ref("fullName")], ...)`'</span>)
subscription.unsubscribe();

<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Subscribing to `ref("fullName")` (again)'</span>);
<span class="hljs-keyword">const</span> result1 = <span class="hljs-keyword">await</span> app.resolve(ref(<span class="hljs-string">'fullName'</span>));
<span class="hljs-built_in">console</span>.log(result);

<span class="hljs-comment">// Console output:</span>
<span class="hljs-comment">// Subscribing to a computed node that produces greeting...</span>
<span class="hljs-comment">// Subscribed to `fullName`</span>
<span class="hljs-comment">// Subscribed to `greeting`</span>
<span class="hljs-comment">// Hello, Bob Smith!</span>
<span class="hljs-comment">// -----------</span>
<span class="hljs-comment">// Subscribing to `ref("fullName")`</span>
<span class="hljs-comment">// Bob Smith</span>
<span class="hljs-comment">// -----------</span>
<span class="hljs-comment">// Unsubscribing from `computed([ref("fullName")], ...)`</span>
<span class="hljs-comment">// Subscribing to `ref("fullName")` (again)</span>
<span class="hljs-comment">// Subscribed to `fullName`</span>
<span class="hljs-comment">// Bob Smith</span>
</code></pre>
<p>This example is a bit longer than usual, but it's illustrating a very important point about how Muster resolves nodes, and the lifecycle of the nodes.</p>
<p>When the first subscription is made, Muster resolves the computed node that depends on a <code>fullName</code> computed node. This creates a subscription to that node, and also <strong>caches the result from that node</strong> for as long as the subscription is open. It serves as a performance improvement because Muster doesn't have to re-compute the value of that node when it's requested the second time.
The second time we subscribe to the <code>fullName</code> node we only get the result of the computation, without calling the <code>combine</code> function of the node - note that the <code>Subscribed to 'fullName'</code> is missing from the console output.
Then we close the original subscription, which frees the resources, and removes the cached value of the <code>fullName</code> node from Muster.
After that we make another subscription to the <code>fullName</code> node which results in <code>Subscribed to 'fullName'</code> being printed to the console output.</p>
<h2><a class="anchor" aria-hidden="true" id="lifecycle-of-a-variable-node-and-how-to-reset-its-value"></a><a href="#lifecycle-of-a-variable-node-and-how-to-reset-its-value" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Lifecycle of a <code>variable()</code> node, and how to reset its value</h2>
<p>The <code>variable()</code> node has a slightly different lifecycle than any other dynamic node. Initially it behaves just like a regular dynamic node - subscribing to it causes its value to be cached by Muster, and the value is removed from the cache once the node is un-subscribed.</p>
<p>Things change once a <code>variable()</code> node value is set. The act of setting a <code>variable()</code> node makes it persistent, in a sense that unsubscribing from that node doesn't clear its value. You can remember that from previous examples of setting the variable, that the newly set value was available to us even though there was no active subscriptions to that variable node.
This raises one question - how to reset the variable to its original state?</p>
<p>Here's where the <code>reset()</code> node comes in handy. It is used to manually clear the value of a variable, and to restore it back to the original state:</p>
<pre><code class="hljs css language-javascript"><span class="hljs-keyword">import</span> muster, { ref, reset, set, variable } <span class="hljs-keyword">from</span> <span class="hljs-string">'@dws/muster'</span>;

<span class="hljs-keyword">const</span> app = muster({
  <span class="hljs-attr">someVariable</span>: variable(<span class="hljs-string">'initial value'</span>),
});

<span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">await</span> app.resolve(ref(<span class="hljs-string">'someVariable'</span>)));

<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Setting the value of someVariable'</span>);
<span class="hljs-keyword">await</span> app.resolve(set(<span class="hljs-string">'someVariable'</span>, <span class="hljs-string">'updated value'</span>));

<span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">await</span> app.resolve(ref(<span class="hljs-string">'someVariable'</span>)));

<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Resetting the someVariable'</span>);
<span class="hljs-keyword">await</span> app.resolve(reset(<span class="hljs-string">'someVariable'</span>));

<span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">await</span> app.resolve(ref(<span class="hljs-string">'someVariable'</span>)));

<span class="hljs-comment">// Console output:</span>
<span class="hljs-comment">// initial value</span>
<span class="hljs-comment">// Setting the value of someVariable</span>
<span class="hljs-comment">// updated value</span>
<span class="hljs-comment">// Resetting the someVariable</span>
<span class="hljs-comment">// initial value</span>
</code></pre>
</span></div></article></div><div class="docLastUpdate"><em>Last updated on 2018-12-4</em></div><div class="docs-prevnext"><a class="docs-prev button" href="/muster/docs/6.3.0/understanding-muster/explicit-definition"><span class="arrow-prev">← </span><span>Explicit Definitions</span></a><a class="docs-next button" href="/muster/docs/6.3.0/understanding-muster/scope"><span>Scope</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#lifecycle-of-a-variable-node-and-how-to-reset-its-value">Lifecycle of a <code>variable()</code> node, and how to reset its value</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/muster/" class="nav-home"><img src="/muster/img/muster.svg" alt="Muster" width="66" height="58"/></a><div><h5>Docs</h5><a href="/muster/docs/overview.html">Overview</a><a href="/muster/docs/learn/introduction.html">Guides</a><a href="/muster/api/">API Reference</a><a href="/muster/playground/">Playground</a><a href="/muster/docs/resources/faq.html">FAQ</a></div><div><h5>Community</h5><a href="/muster/en/users.html">User Showcase</a><a href="http://stackoverflow.com/questions/tagged/muster" target="_blank" rel="noreferrer noopener">Stack Overflow</a></div><div><h5>More</h5><a href="/muster/docs/changelog.html">Changelog</a><a href="https://github.com/dwstech/muster">GitHub</a><a class="github-button" href="https://github.com/dwstech/muster" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><a href="https://www.github.com/dwstech/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/muster/img/dws-logo-global.svg" alt="DWS Technology Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2018 DWS Technology</section></footer></div></body></html>